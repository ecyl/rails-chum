<div class="container user-profile">
  <%# sidebar %>
  <div class="user-sidebar">
    <%# user profile details %>
    <div class="profile-details">
      <%# avatar %>
      <div class="user-avatar center">
        <%= cl_image_tag @user.photo.key, class: "avatar", 'aria-haspopup': true, 'aria-expanded': false %>
      </div>

      <%# verification information %>
      <div class="user-verification">
        <div class="user-verification info">
          <% if @user.reviews.length == 0 %>
            <em>There are no reviews for <%= @user.first_name %> yet</em>
          <% else %>
            <i class="fa-solid fa-star"></i> <%= @user.review.length %>
          <% end %>
        </div>
        <div class="user-verification info">

          <% @user.itineraries.each do |itinerary| %>
            <% organised_trips = itinerary.itinerary_users.where(status: "organiser") %>
            <% if organised_trips.length == 0 %>
              <em><%= @user.first_name %> has not organised any trips yet</em>
              <% else %>
              <i class="fa-solid fa-globe"></i> Organised <%= organised_trips.length %> trips
            <% end %>
          <% end %>
        </div>
      </div>

      <%# Send message %>
      <div class="message">
        <span><%= link_to "Send message", user_chatrooms_path(@user.id), method: :post, class: "btn-purple"%></span>
      </div>
    </div>
  </div>

  <%# content %>
  <div class="user-content">
    <%# About Me %>
    <div class="about-me">
      <%# Name %>
      <div class="about-me content">
        <h2>Hi, I'm <%= @user.first_name %></h2>
      </div>
      <%# Age, Gender %>
      <div class="about-me content">
        <span><%= @user.age %>, <%= @user.gender %></span>
      </div>
      <%# lives in XX %>
      <div class="about-me content">
        <i class="fa-solid fa-house"></i>
        <span>Lives in Singapore</span>
      </div>
    </div>

    <div class="line-break">
    </div>

    <%# Reviews %>
    <div class="user-reviews">
      <div class="user-description-title">
        <% if @user.reviews.length == 0 %>
            <em>There are no reviews for <%= @user.first_name %> yet</em>
          <% else %>
            <i class="fa-solid fa-star"></i> <%= @user.review.length %>
          <% end %>
      </div>
      <%# iterate through reviews %>
        <% @user.itineraries.each do |itinerary| %>
          <% itinerary.reviews.each do |review| %>
            <div class="review-content">
              <%# display the review content %>
              <%= review.content %> <br>
              <%# display the author of the review %>
              <% sender = User.find(review.user_id) %>
              From: <%= sender.first_name %>
            </div>
          <% end %>
        <% end %>
    </div>
  </div>
</div>
